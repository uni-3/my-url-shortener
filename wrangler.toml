name = "my-url-shortener"
main = ".open-next/worker.js"
compatibility_date = "2026-02-03" # Updated to match OpenNext
compatibility_flags = ["nodejs_compat", "global_fetch_strictly_public"]
preview_urls = true

[assets]
directory = ".open-next/assets"
binding = "ASSETS"


[observability]
enabled = true

# Development environment
[env.development]
name = "my-url-shortener-dev"
routes = [
  { pattern = "dev-s.uni-3.app", custom_domain = true }
]

[[env.development.services]]
binding = "WORKER_SELF_REFERENCE"
service = "my-url-shortener-dev"

[env.development.images]
binding = "IMAGES"

# Production environment
[env.production]
name = "my-url-shortener"
routes = [
  { pattern = "s.uni-3.app", custom_domain = true }
]

[[env.production.services]]
binding = "WORKER_SELF_REFERENCE"
service = "my-url-shortener"

[env.production.images]
binding = "IMAGES"

# Environment variables
[env.development.vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"

[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"
GRAFANA_OTLP_ENDPOINT = "https://otlp-gateway-prod-ap-northeast-0.grafana.net/otlp/v1/traces"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "url-shortener-development"
database_id = "your-development-database-id"
migrations_dir = "migrations"

# KV namespace binding (for caching)
[[kv_namespaces]]
binding = "URL_CACHE"
id = "your-development-kv-namespace-id"

[[env.production.d1_databases]]
binding = "DB"
database_name = "url-shortener-production"
database_id = "e15fa00a-2e1f-4a2d-bcbe-3af3689b3394"
migrations_dir = "migrations"

[[env.production.kv_namespaces]]
binding = "URL_CACHE"
id = "458d4e3405de402c988c8575ef883eec"
